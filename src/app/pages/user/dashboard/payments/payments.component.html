<div class="ms-lg-5">
    <h5 class="h2color mb-4">Payments 
        <span class="fw-bold font9rem primary-color ms-3 cursorpointer" (click)="onShowCreditCardModal()">+ Add Payment Method</span>
    </h5>
    <div class="row">
        <div class="col-md-4" *ngFor="let card of cards">
            <div class="card light-bg">
                <div class="card-body p-lg-4">
                    <div class="row d-flex align-items-center" style="min-height: 40px;">
                        <div class="col-md-3">
                            <img class="ms-3" [src]="getIssuerIcon(card.cardType)" [alt]="card.cardType" class="w-100 rounded-3">
                        </div>
                        <div class="col-md-9">
                            <h6 class="mb-0 ms-3">Card Ends with: {{getLastFourDigit(card.cardNo)}}</h6>
                            <span *ngIf="card.isDefault" class="badge bg-primary ms-3 font7rem">Default</span>
                        </div>
                    </div>
                    <div class="d-flex align-items-center justify-content-between mt-4">
                        <div>
                            <h6 class="font9rem mb-1">Name</h6>
                            <p class="font8rem">{{card.fullName}}</p>
                        </div>
                        <div class="ms-5">
                            <h6 class="font9rem mb-1">Expiry</h6>
                            <p class="font8rem">{{card.expiryDate}}</p>
                        </div>
                        <div class="ms-3">
                            <button class="btn btn-outline-danger btn-sm" (click)="onDeleteClick(card._id)">Delete</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal for add credit card -->
<div [ngStyle]="{'display':creditCardModalDisplay}" class="modal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Add New Credit Card</h5>
          <button type="button" class="btn-close" (click)="creditCardModalDisplay = 'none'"></button>
        </div>
        <form [formGroup]="cardForm" (ngSubmit)="onSubmit()">
          <div class="modal-body addcardtext">
              <div class="row">              
                  <div class="mb-3 row">
                    <div class="col-md-10">
                      <label class="mb-1 fontsm fw-bold">Credit Card Number</label>
                      <input type="text" class="form-control" formControlName="cardNo"
                      [maxlength]="maxLength"
                      (keyup)="validate()"
                      [imask]="imask"
                      [unmask]="true"
    
                        [ngClass]="[submitted && f.cardNo.errors ? 'is-invalid' : '']" 
                      >
                      <div *ngIf="submitted && f.cardNo.errors" class="invalid-feedback">
                        <div *ngIf="f.cardNo.errors.required">Card number is required</div>
                      </div>
                    </div>
                    <div class="col-md-2">
                      <!-- <img *ngIf="validationRes?.card" [src]="getIssuerIcon()"> -->
                      <div class="position-relative">
                        <img  *ngIf="validationRes?.card" [src]="getIssuerIcon(validationRes.card.type)" alt="validationRes.card.type" class="w-100 rounded-3" style="margin-top: 50%;">
                      </div>
                    </div>
                  </div>
                  <div class="mb-3 row">
                      <div class="col-md-4">
                          <label class="mb-1 fontsm fw-bold">Expiry Date</label>
                          <input type="text" class="form-control" placeholder="00/00" [imask]="{mask:'00/00'}" formControlName="expiryDate" 
                            [ngClass]="[submitted && f.expiryDate.errors ? 'is-invalid' : '',  submitted && !f.expiryDate.errors ? 'is-valid' : '']" 
                          >
                          <div *ngIf="submitted && f.expiryDate.errors" class="invalid-feedback">
                            <div *ngIf="f.expiryDate.errors.required">Expiry is required</div>
                            <div *ngIf="f.expiryDate.errors.pattern">Invalid expiry</div>   
                          </div>
                      </div>
                      <div class="col-md-3">
                          <label class="mb-1 fontsm fw-bold">CVV</label>
                          <input type="text" class="form-control" formControlName="cvvNo" [maxlength]="maxCvvLength" numbersOnly
                            [ngClass]="[submitted && f.cvvNo.errors ? 'is-invalid' : '',  submitted && !f.cvvNo.errors ? 'is-valid' : '']" 
                          >
                          <div *ngIf="submitted && f.cvvNo.errors" class="invalid-feedback">
                            <div *ngIf="f.cvvNo.errors.required">CVV is required</div>
                            <div *ngIf="f.cvvNo.errors.minlength">Invalid CVV</div>                          
                          </div>
                      </div>
                  </div>                
                  <div class="mb-3">
                    <label class="mb-1 fontsm fw-bold">Full Name On Card</label>
                    <input type="text" class="form-control" formControlName="fullName" 
                      [ngClass]="[submitted && f.fullName.errors ? 'is-invalid' : '',  submitted && !f.fullName.errors ? 'is-valid' : '']" 
                    >
                    <div *ngIf="submitted && f.fullName.errors" class="invalid-feedback">
                      <div *ngIf="f.fullName.errors.required">Full name is required</div>
                    </div>
                </div>
                  <div class="mb-3">
                      <label class="mb-1 fontsm fw-bold">Billing Address</label>
                      <input type="text" class="form-control" formControlName="address">
                  </div>
                  <div class="mb-3 row">
                      <div class="col-md-6">
                          <label class="mb-1 fontsm fw-bold">City</label>
                          <input type="text" class="form-control" formControlName="city">
                      </div>
                      <div class="col-md-6">
                          <label class="mb-1 fontsm fw-bold">State</label>
                          <input type="text" class="form-control" formControlName="state">
                      </div>
                  </div>
                  <div class="mb-3 row">
                      <div class="col-md-6">
                          <label class="mb-1 fontsm fw-bold">Zip/Pin code</label>
                          <input type="text" class="form-control" formControlName="pinCode">
                      </div>
                      <div class="col-md-6">
                          <label class="mb-1 fontsm fw-bold">Country</label>
                          <select class="form-select" class="form-select" formControlName="country"
                                [ngClass]="[submitted && f.country.errors ? 'is-invalid' : '',  submitted && !f.country.errors ? 'is-valid' : '']"
                            >
                              <option value="us">United States</option>
                              <option value="ind">India</option>
                          </select>
                          <div *ngIf="submitted && f.country.errors" class="invalid-feedback">
                            <div *ngIf="f.country.errors.required">Country is required</div>
                          </div>
                      </div>
                  </div>
              </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn fontsm" data-bs-dismiss="modal">Close</button>
            <button type="submit" class="btn btn-primary fontsm">Add New Card</button>
          </div>
        </form>
      </div>
    </div>
  </div>